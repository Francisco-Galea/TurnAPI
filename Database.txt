CREATE DATABASE TurnsApi;
GO;

CREATE TABLE Accounts (
	AccountId INT PRIMARY KEY NOT NULL IDENTITY (1,1),
	Document INT NOT NULL UNIQUE,
	Name NVARCHAR(30) NOT NULL,
	LastName NVARCHAR(30) NOT NULL,
	PhoneNumber NVARCHAR(40),
	Password NVARCHAR(MAX) NOT NULL,
	IsActive BIT NOT NULL DEFAULT 1
);

CREATE TABLE Companies (
	CompanyId INT PRIMARY KEY IDENTITY (1,1),
	CompanyName NVARCHAR(30) NOT NULL,
	SocialName NVARCHAR(50) NOT NULL UNIQUE,
	Cuit NVARCHAR(40) NOT NULL,
	FounderAccountId INT NOT NULL FOREIGN KEY (FounderAccountId) REFERENCES Accounts(AccountId),
    IsActive BIT NOT NULL DEFAULT 1
);

CREATE TABLE Employees 
(
	EmployeeId INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	PositionInCompany NVARCHAR(40) NOT NULL,
	DescriptionOfPosition NVARCHAR(MAX),
	AccountId INT NOT NULL FOREIGN KEY (AccountId) REFERENCES Accounts (AccountId),
	CompanyId INT NOT NULL FOREIGN KEY (CompanyId) REFERENCES Companies (CompanyId),
	IsHired BIT NOT NULL DEFAULT 1
);

CREATE TABLE Agendas 
(
	AgendaId INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	CompanyId INT NOT NULL FOREIGN KEY (CompanyId) REFERENCES Companies (CompanyId),
	Name NVARCHAR(30) NOT NULL,
	Description NVARCHAR(80),
	IsActive BIT NOT NULL DEFAULT 1
);

CREATE TABLE AgendaSchedules 
(
	AgendaScheduleId INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	AgendaId INT NOT NULL FOREIGN KEY (AgendaId) REFERENCES Agendas (AgendaId),
	WorkableDay NVARCHAR(9) NOT NULL,
	AppointmentDurationInMinutes INT NOT NULL,
	AppointmentInit TIME(2) NOT NULL,
	AppointmentEnd Time(2) NOT NULL,
	IsActive BIT NOT NULL DEFAULT 1
);

CREATE TABLE Appointments
(
	AppointmentId INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	AgendaId INT NOT NULL FOREIGN KEY (AgendaId) REFERENCES Agendas (AgendaId),
	ClientId INT NOT NULL FOREIGN KEY (ClientId) REFERENCES Accounts (AccountId),
	AppointmentDate DATE NOT NULL,
	AppointmentInit TIME NOT NULL,
	AppointmentEnd TIME NOT NULL,
	AppointmentState INT NOT NULL,
	Note NVARCHAR(MAX)
);

CREATE TABLE EmployeesAgendas(
	EmployeeId INT NOT NULL FOREIGN KEY (EmployeeId) REFERENCES Employees (EmployeeId),
	AgendaId INT NOT NULL FOREIGN KEY (AgendaId) REFERENCES Agendas (AgendaId)
);